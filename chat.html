<!DOCTYPE html>
<html lang="ja">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta charset="UTF-8">
<title>セントラルホテルQ&Aチャット</title>

<style>
  html, body {
  margin: 0;
  padding: 0;
}
  
/* ===== 共通 ===== */
#chatbox {
  width: 360px;
  max-width: 95vw;
  height: 520px;
  max-height: 75dvh;
  border: 1px solid #ccc;
  border-radius: 12px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.3);
  position: fixed;
  bottom: 20px;
  right: 20px;
  background: #fff;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  z-index: 9999;
}

#chatHeader {
  background: #2e7d32;
  color: white;
  padding: 10px;
  font-size: 14px;
  font-weight: bold;
  display: flex;
  gap: 8px;
}

#chatHeader .backBtn {
  cursor: pointer;
  font-size: 18px;
}

#messages {
  flex: 1;
  overflow-y: auto;
  padding: 10px;
  background: #fafafa;
}

.msg {
  margin: 6px 0;
  padding: 8px 10px;
  border-radius: 10px;
  max-width: 80%;
  word-wrap: break-word;
  font-size: 14px;
}

.user { background: #d1f0d1; align-self: flex-end; }
.bot  { background: #f0f0f0; align-self: flex-start; }

#inputArea {
  display: flex;
  border-top: 1px solid #ddd;
  padding: 6px;
}

#userInput {
  flex: 1;
  padding: 8px;
  border: 1px solid #ccc;
  border-radius: 8px;
  font-size: 14px;
}

#sendBtn, #micBtn {
  margin-left: 5px;
  padding: 8px 12px;
  border: none;
  border-radius: 8px;
  background: #0078d7;
  color: white;
  font-size: 14px;
  cursor: pointer;
}

/* ===== 録音中：青背景＋赤丸（点滅＋パルス） ===== */
#micBtn.recording {
  background: #0078d7 !important; /* 🎤と同じ青 */
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  color: #ff5252;
  position: relative;
  overflow: visible;
}

/* マイク文字を完全に消す */
#micBtn.recording::before {
  content: "";
}

/* 赤丸本体（点滅） */
#micBtn.recording::after {
  content: "●";
  line-height: 1;
  animation: micBlink 1.2s infinite ease-in-out;
  z-index: 2;
}

/* パルス波紋 */
#micBtn.recording span {
  display: none;
}

#micBtn.recording::marker {
  display: none;
}

#micBtn.recording::selection {
  background: transparent;
}

/* 外側パルス */
#micBtn.recording::backdrop {
  display: none;
}

/* 擬似要素でパルス生成 */
#micBtn.recording::before {
  content: "";
  position: absolute;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: rgba(255,82,82,0.6);
  animation: micPulse 1.5s infinite;
  z-index: 1;
}

/* 点滅 */
@keyframes micBlink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.4; }
}

/* パルス拡散 */
@keyframes micPulse {
  0% {
    transform: scale(1);
    opacity: 0.6;
  }
  100% {
    transform: scale(4);
    opacity: 0;
  }

/* ===== スマホ：強制viewport固定（最終解） ===== */
@media screen and (max-width: 600px) {

  /* fixed計算を完全にリセット */
  #chatbox {
    all: unset;
    position: fixed;
    inset: 8px;
    display: flex;
    flex-direction: column;

    background: #fff;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    z-index: 9999;
  }

  /* ヘッダーと中身を100%拘束 */
  #chatHeader,
  #messages,
  #inputArea {
    width: 100%;
    box-sizing: border-box;
  }

  #chatHeader > div {
    width: 100%;
    white-space: normal;
    word-break: keep-all;
    overflow-wrap: break-word;
  }

}
  
</style>
</head>

<body>

<div id="chatbox">
  <div id="chatHeader">
    <span class="backBtn" title="公式サイトへ戻る">←</span>
    <div>
      矢印クリックで公式サイトへ..<br>
      ☆セントラルホテル取手Q&Aチャットです☆<br>
      ☆下記直接入力、スマホ音声入力対応です☆
    </div>
  </div>

  <div id="messages"></div>

  <div id="inputArea">
    <input id="userInput" placeholder="ご質問をどうぞ…">
    <button id="micBtn">🎤</button>
    <button id="sendBtn">送信</button>
  </div>
</div>

<script>
/* ===== 戻る ===== */
document.querySelector(".backBtn").onclick = ()=>{
  window.open("https://www.centralhoteltoride.com/","_blank","noopener");
};

/* ===== FAQ（例：ここに全文入れてOK） ===== */
const faq=[
 {
keywords:["チェックイン","ちぇっくいん","チェックイン時間"],
answer:`チェックイン時間は宿泊当日15:00〜です。早めのチェックインをご希望の際は有償によるご対応が可能です。フロントスタッフまたは、事前に 0297-72-1123 までお問合わせください。お待ちいただく際にはウエルカムドリンクコーナーもございますのでご利用ください。`
},

{
keywords:["チェックアウト","ちぇっくあうと","チェックアウト時間","オーバーチャージ","遅め","遅く","レイト","超過","延長"],
answer:`チェックアウト時間は翌朝10:00です。（プランにより異なる場合がございます）有償によるご対応も可能です。フロントスタッフまたは、事前に 0297-72-1123 までお問合わせください。`
},

{
keywords:["アーリーチェックイン","早めの","早めに"],
answer:`お部屋の準備状況によりますが有償によるご対応が可能です。フロントスタッフまたは、事前に 0297-72-1123 までお問合わせください。お待ちいただく際にはウエルカムドリンクコーナーもございますのでご利用ください。`
},

{
keywords:["レイト","オーバーチャージ","遅め","遅く","超過"],
answer:`有償によるご対応が可能です。フロントスタッフまたは、事前に 0297-72-1123 までお問合わせください。`
},

{
keywords:["個人","ネット","個別","予約方法","団体","宿泊予約"],
answer:`お電話でのご予約以外に、弊社(自社サイト)、他社(楽天、じゃらん等)インターネットをご利用いただいたご予約も可能です。無料駐車場の台数に限りがありますので駐車場のご予約は承れません。大型車両(バス、トラックなど)の際は「バス・大型・トラック」等の質問をお願いします。団体様によるご宿泊は事前に 0297-72-1123 までお問合わせください。`
},

{
keywords:["多人数","バス","トラック"],
answer:`個人様の場合は先着順となりますが、団体様のご予約は車両の大きさにより承っております。ご相談いただければバス(マイクロバス)、トラックなど駐車スペースのご対応も可能です。事前に 0297-72-1123 までお問合わせください。`
},

{
keywords:["支払方法","支払い","お支払い","一括払い","現金","QR","決済","メルペイ","D払い","クレジット"],
answer:`現金、クレジットカード、QR決済（メルペイ・Dカード）に対応しております。チェックイン時にスタッフが対応致します。他社サイト（楽天、じゃらん等）をご利用の場合、「事前決済」も選択可能です。自社サイト・お電話予約をご利用の際はAカードポイント付与がお勧めです。「ポイントカードについて」でご質問ください。`
},

{
keywords:["Aカード","ポイント","期間","還元","ポイントカード","発行","アカード"],
answer:`当館ではAカードの即時発行・当日からポイント付与が可能です。Aカードによるポイント付加はご宿泊プランにより付加率が異なります。お得なポイントの貯め方や還元方法、あと何ポイントで現金還元が可能かなどお気軽にスタッフにお尋ねください。クレジットカードでのお支払いのご質問は「カード払い」でご質問ください。`
},

{
keywords:["領収書","宿泊証明書","レシート","発行","インボイス"],
answer:`ホテルにてお支払いを頂いた場合チェックアウト時にインボイス対応「領収書」をお渡しいたします。他社サイト（楽天、じゃらん等）をご利用の「事前決済」の際は領収書は予約サイトにて印刷しご利用ください。（ホテルでの領収書は発行できませんがご希望の方には「宿泊証明書」のお渡しは可能です。）`
},

{
keywords:["料金","りょうきん","宿泊料","お部屋代","一泊料金"],
answer:`宿泊料金は、お部屋タイプや宿泊日ごとでも変わります。子供料金の設定や長期滞在割引、団体割引等はございません。当館Webサイトにてご確認いただくか事前に 0297-72-1123 までお問合わせください。他社サイト（楽天、じゃらん等）をご利用の「事前決済」の際は領収書は予約サイトにて印刷しご利用ください。（ホテルでの領収書は発行できませんがご希望の方には「宿泊証明書」のお渡しは可能です。）`
},

{
keywords:["貸し出し","足が悪い","年寄","年配","車いす","車イス","杖","不自由","バリアフリー","身障","雨","障害","車椅子","盲導犬","充電器"],
answer:`当館にバリアフリー対応のお部屋はございません。貸し出し品はスマホ用充電器、ヘアーアイロン、アイスペール、スチームアイロン、体温計、カサ、扇風機、セラミックヒーター、毛布、加湿器、車イス、バス・トイレ入口用低段差階段などがあります。その他につきましてはスタッフにお尋ねいただくか事前に 0297-72-1123 までお問合わせください。`
},

{
keywords:["ドライヤ","ドライア","どらいや","どらいあ","ハンガ","はんがー","消臭","しょうしゅう","スリッパ","髭","ひげ","ブラシ"],
answer:`お部屋備え付けとしてドライヤー、ハンガー、消臭剤、物干し棒、スリッパ、シャンプー、リンス、ボディソープ、歯ブラシ、髭剃り、延長コード、メモ帳、ボールペン、非常灯などがあります。他に貸出し品も別途ございますのでごフロントスタッフまでお尋ねください。`
},

{
keywords:["駐輪場","自転車","バイク","二輪","２輪","オートバイ","乗り物"],
answer:`ご宿泊期間中のご利用に限り、地下駐車場の一番奥の駐輪場（自転車、オートバイ）がご利用いただけます。地下駐車場より2階フロントまではエレベーターがご利用いただけます。`
},

{
keywords:["キツエン","喫煙","きつえん","煙草","吸う"],
answer:`館内にタバコの販売機・喫煙場所はございません。喫煙場所をお探しの際は取手駅の喫煙所（徒歩3分位）をご案内させて頂いております。館内全体では喫煙ルーム（48室・ツイン、DXシングル含む）禁煙ルーム（72室・ツイン、DXシングル含む）がございます。禁煙指定のお部屋による喫煙を発見した場合は「特別清掃費、不売日数分の補償」をご請求させていただく場合がございます。`
},

{
keywords:["キンエン","禁煙","きんえん","くさい","臭い","部屋数"],
answer:`館内全体では禁煙ルーム（72室・ツイン、DXシングル含む）喫煙ルーム（48室・ツイン、DXシングル含む）がございます。喫煙指定部屋以外は館内全て禁煙となりますがエレベーター、自販機・洗濯室など多くの方がご利用いただく場所では臭いが気になる場合はございます。禁煙指定のお部屋による喫煙を発見した場合は「特別清掃費、不売日数分の補償」をご請求させていただく場合がございます。`
},

{
keywords:["未成年","子供","みせいねん","こどもだけ","承認","承諾","中学生","高校生","夏休","子供のみ"],
answer:`未成年者のみでの宿泊は可能ですが、高校生以上（15歳以上）とさせていただきます。必ず「保護者の同意書」が必要になりますのでご持参ください。同意書が無い場合はご宿泊いただけません。ご不明な点等ございましたら事前に 0297-72-1123 までお問合わせください。`
},

{
keywords:["氷","製氷機","ジュース","アルコール","ビール","お酒","自販機","アイスペール","自動販売機"],
answer:`4階にジュース、ビール自販機、2階、8階にジュース自販機がございます。4階はランドリーと一緒に製氷機があります。アイスペール等の貸し出し品ご希望の際はフロントにてお渡しさせていただきます。`
},

{
keywords:["朝食","あさごはん","朝ごはん"],
answer:`朝食はフロントにてお弁当形式となります。6:30～9:00の間で取りに来ていただきお部屋でお召し上がり頂いています。`
},

{
keywords:["マッサージ","あんま"],
answer:`マッサージの申込・予約等はお受けできません。取手駅東口にタイマッサージアンチェラ、祥和堂ソフトマッサージ、西口に、ほぐし家将がございますのでご利用ください。`
},

{
keywords:["デリバリ","ウーバー","出前","ピザ"],
answer:`外部からの配達をご利用の際は2Fフロントにて受け渡しを行って頂きます。お部屋までの配達はお受けできませんのでお客様と配達員の方は直接受け渡しを2Fフロントにてお願いします。`
},

{
keywords:["新聞","スポーツ","読売","朝日","日経","朝刊","夕刊"],
answer:`閲覧用新聞が「3紙」、有料新聞「1紙」2Fフロントにございます。現在サービスとして「読売新聞・朝刊」が無料にて配布しておりますのでお部屋までお持ちいただいてお読みいただけます。`
},

{
keywords:["トイレ","お手洗","おてあらい","といれ"],
answer:`フロント(2F)にある男女トイレがご利用いただけますのでフロントスタッフにお尋ねください。チェックイン後は各お部屋にユニットバス形式のバス・トイレをお使いいただけます。`
},

{
keywords:["wifi","ワイファイ","うぃふぃ","ネット","無線","有線"],
answer:`無料Wi-Fiがご利用いただけます。お部屋の「デスク鏡右下にSSID・パスワード」が記載されています。館内は同一パスワードにて繋がりますので電波の強いSSIDをお選びいただきご利用ください。有線LANをご希望の場合は事前に 0297-72-1123 までお問い合わせください。`
},

{
keywords:["駐車","パーキング","有料","大型","事前","レンタカー","ぱーきん","れんたか"],
answer:`ご宿泊期間中に限りご利用可能な無料駐車場がございます。台数に限りがありますのでご予約は承れません。ご了承ください。ご連泊のかたは駐車券をお渡し致しますのでチェックイン時にフロントにてお申し付けください。レンタカーご利用・ご希望の際は割引券（日本レンタカーのみ）をお渡し致しますのでご活用ください。（尚、チェックイン前の車両のご駐車、チェックアウト後のご駐車はご遠慮いただきます様お願いします。）大型車両は事前にお問い合わせください：0297-72-1123`
},

{
keywords:["ベッド","サイズ","広さ","ひろさ","大きさ","部屋タイプ","部屋の種類"],
answer:`お部屋の広さは和室・ツインルームが24㎡、DXシングルルームが15.4㎡、シングルルームが12㎡になります。各ベッドサイズはツインルームが（シングルベッドサイズ、1030mm×1970mm）が2台入り、DXシングルルーム（ダブルベッドサイズ、1400mm×1970mm）が1台、シングルルーム（セミダブルサイズ、1230mm×1970mm）が1台の設置になります。ご不明な点等ございましたら事前にお問い合わせください：0297-72-1123`
},

{
keywords:["宅急便","荷物","配送","たっきゅう"],
answer:`フロントにて荷物をお預かり可能です。ホテル宛に送付時は伝票に「お客様氏名・チェックイン日」を記入ください。ホテルからお送りする場合はヤマト運輸のみお取り扱い可能です。`
},

{
keywords:["ダブルルーム","ベッド","ツイン","広い","広め","追加"],
answer:`ダブルルームは広めのベッドで2人までお休みいただくお部屋です。ベッドが別々をご希望ならツインルームをご利用ください。他には和室のお部屋もございます。ベッド利用のお部屋にて1ベッド、2人以上１室でのお泊りをご希望の際は事前に 0297-72-1123 までお問合わせください。`
},

{
keywords:["洗濯","ランドリー","洗濯機","乾燥機"],
answer:`4階・8階にランドリーがございます。アイス(氷)は4階ランドリールームにございます。`
},

{
keywords:["レンジ","温め","電子レンジ","お弁当"],
answer:`4階・8階のランドリールームに電子レンジがございます。また、2階フロント脇にも設置してございます。`
},

{
keywords:["ドリンク","ウェルカム","コーヒー","お茶","水","あめにて","アメニテ","ウエルカム","飲み物"],
answer:`2階フロアにてウェルカムドリンクとしてドリンクコーナー（コーヒー、緑茶、紅茶、むぎ茶）がご利用いただけます。また、女性の方にはチェックイン時にホテルオリジナルのアメニティセット（ブラシ、スキンケア、パック、スポンジ、入浴剤etc）をお渡しいたします。`
},

{
keywords:["コンビニ","ローソン","セブン"],
answer:`取手駅東口ローソンまで徒歩3分です。セブンイレブンまで5分くらいになります。`
},

{
keywords:["エレベータ","階段","門限"],
answer:`エレベーターの利用時間はam5：30～24：00となります。0:00～5:30までの間は防犯の為2階から下の階（1階及び地下B1）には移動しません。0:00を過ぎるチェックインの際は階段にて2階フロントまでお越しください。`
},

{
keywords:["コピー","ぷりんと","プリント","プリンタ","こぴ","印刷","fax","FAX","ファック"],
answer:`有料になりますが承ります。フロントスタッフまたは事前に 0297-72-1123 までお問い合わせください。コンビニエンスストアは取手駅東口ローソンまで徒歩3分です。セブンイレブンまで5分くらいになります。`
},

{
keywords:["夕飯","食事","夕食","ごはん","ディナー","飲食店","飲み","バー","ガールズ"],
answer:`ご夕食は現在承っておりません。フロントにて近隣飲食店マップ(お食事処、居酒屋など)をお渡しします。ご活用くださいませ。`
},

{
keywords:["割引","長期","ロングステイ","コイン","長い","滞在","パーキング"],
answer:`現在、子供料金の設定や団体割引、長期滞在（ロングステイ）に関して割引料金の設定はありません。また、近隣のコインパーキングご利用の際も割引券等ありません事ご了承ください。`
},

{
keywords:["観光","遊ぶ","見る","イベント","行事","催し","遊び"],
answer:`ホテル裏手に長禅寺、夏は取手花火大会。取手市民会館では多々イベント(コンサート、漫才、演劇、映画など)が行われています。少し足を延ばすと牛久大仏・牛久沼、つくばエキスポセンターなどもあります。`
},

{
keywords:["駅","アクセス","電車","最寄り駅","改札","出口"],
answer:`「JR取手駅」が最寄り駅になります。東口改札を出て右手側に在るローソン先の信号を渡り右方向へお進みください。徒歩約3分くらいで当ホテルに着きます。上野・品川方面行は前寄り、土浦・水戸方面行は後ろ寄りにご乗車いただくと「東口改札」出口に近くなります。迷われた場合は {TEL} までご連絡ください。`
},

{
keywords:["車","自動車","行き方","道順","方向"],
answer:`ナビ利用は「セントラルホテル取手」または「茨城県取手市取手2-4-3」に設定して下さい。常磐自動車道・谷和原ICより約30分。東京方面よりお越しの際は国道6号を大利根橋通過後右折（県道11号へ）、水戸、土浦方面よりお越しの際は大利根橋手前で利根方面（県道11号へ）進み、常磐線のガードをくぐるとすぐに信号があります。取手駅東口方面に左折し、すぐ右側が当ホテルです。`
},

{
keywords:["住所","場所"],
answer:`当館の場所は、〒302-0004、茨城県取手市取手2-4-3、TEL.0297-72-1123、FAX.0297-72-7788 になります。`
},

{
keywords:["お風呂","ユニットバス","大浴場","バスルーム"],
answer:`お風呂はお部屋のユニットバスをご利用いただきます。大浴場はありません。`
},

{
keywords:["パンク","ガソリン","燃料","給油"],
answer:`車で5分ほどのところにガソリンスタンドがございます。フロントスタッフにお尋ねください。`
},

{
keywords:["病院","歯科","熱","風邪","ねつ","かぜ","カゼ","インフル","コロナ","病気","痛い"],
answer:`風邪、歯痛などであれば近隣にある病院をご案内いたします。JAとりで総合医療センターなど大きな病院もございます。フロントスタッフにお尋ねください。`
},

{
keywords:["本屋","携帯ショップ","ドコモ","ソフトバンク","au","スマホ","買い物","ショッピング","西口","百斤","百均"],
answer:`取手駅西口に成城石井(アトレ)、西友(リボン取手)、Tマルシェ取手(アトレ)、ダイソー(リボン取手)、くまざわ書店(アトレ)などがあります。ドコモ、ソフトバンク、AUなどのショップは若干遠くなりますが294号線沿いにございます。`
},

{
keywords:["お問い合わせ","問い合わせ先","連絡先","電話番号"],
answer:`ご不明点等ございましたら 0297-72-1123 までお問い合わせください。`
},

{
keywords:["門限","間に合わない","遅れる","台風","病気"],
answer:`門限は特にありませんがエレベーターは2階フロントから下の階は防犯上夜間（0:00～5：30）は動作しません。チェックインが2時間以上遅れる際にはご一報くださいませ。ご不明点等ございましたら 0297-72-1123 までお問い合わせください。`
},

{
keywords:["添い寝","3人","4人","5人","ベッド","そい寝","和室","小学生","幼児","赤ちゃん"],
answer:`和室のお部屋は大人の方4名の宿泊が出来ます。事前ご予約になりますが洋室ツインのお部屋に簡易ベッドをご用意しての3名様宿泊もご対応致します。小学生以上は大人1名様と数えます。小学生未満のお子様は添い寝が可能です。添い寝をご希望される場合は人数規定がございますので事前に 0297-72-1123 までお問い合わせください。`
},

{
keywords:["キャンセル","キャンセル料","いつまで","何日前"],
answer:`個人でのお泊りについて宿泊前日のキャンセルは宿泊料金の20％、ご宿泊当日15時までにキャンセルご連絡いただいた場合は宿泊料金の80％を頂戴させて頂きます。宿泊当日15時以降、及びご連絡が無い場合は宿泊料金の100％を頂戴致します。団体予約、旅行代理店予約に関してのキャンセル料金につきましては 0297-72-1123 までお問い合わせください。`
},

{
keywords:["フロント","問合せ","内線番号"],
answer:`2階はフロント受付になります。お部屋からは内線9番を押してください。フロントスタッフが対応致します。`
},

{
keywords:["ありがと","わかった","りょうかい"],
answer:`お力になれてとても嬉しいです。他にご質問ございましたら何時でもお話しください。スタッフへのご用命はお部屋から内線9番を押してください。フロントスタッフがご対応致します。`
},

{
keywords:["姉妹","系列","しまいてん"],
answer:`ホテルは3箇所ございまして、茨城県取手市【セントラルホテル取手】、同鹿嶋市【鹿島パークホテル】、群馬県高崎市【セントラルホテル高崎】がございます。お仕事やご旅行などお泊りの際には是非ご利用ください。`
},

{
keywords:["タバコ","煙草","たばこ","電子たばこ","アイコス"],
answer:`当館にタバコ販売機・喫煙所の設置はありません。喫煙可のお部屋以外でのお煙草(電子タバコ含む)はご遠慮ください。禁煙指定のお部屋による喫煙を発見した場合は「特別清掃費、不売日数分の補償」をご請求させていただきます。`
},

{
keywords:["冷房","暖房","エアコン","暑い","寒い","空調"],
answer:`空調は一括制御になりますのでお部屋毎の温度設定は出来ません。時計の横にある丸いつまみを回すことにより風速「弱、中、高」を変化させることができます。`
},

{
keywords:["掃除","清掃","そうじ","せいそう","時間","始まる","終わる","始め","終了","しない","赤札","白札"],
answer:`お掃除は毎朝10：00より開始となります。要・不要に関しましてドア内側にあるプラスティック札を外側にご提示いただく事でお伝えいただく事も可能です。お時間を変更してのお掃除ご依頼は13：00までになります。フロントに直接ご依頼ください。`
}
];

/* ===== QAロジック ===== */
function findAnswer(query){
  query = query.toLowerCase();
  for(const item of faq){
    for(const kw of item.keywords){
      if(query.includes(kw)) return item.answer;
    }
  }
  return "申し訳ありません。その質問にはまだ対応していません。0297-72-1123までお問い合わせください。";
}

/* ===== DOM ===== */
const messages = document.getElementById("messages");
const userInput = document.getElementById("userInput");
const sendBtn = document.getElementById("sendBtn");
const micBtn = document.getElementById("micBtn");

/* ===== タイプライター ===== */
function typeWriter(text, element, speed=20){
  element.textContent = "";
  let i = 0;
  function typing(){
    if(i < text.length){
      element.textContent += text.charAt(i);
      i++;
      setTimeout(typing, speed);
    }
  }
  typing();
}

function addMessage(msg, isUser=false){
  const div = document.createElement("div");
  div.className = "msg " + (isUser ? "user" : "bot");
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;

  if(isUser){
    div.textContent = msg;
  } else {
    typeWriter(msg, div, 20);
  }
}

/* ===== 送信 ===== */
sendBtn.onclick = ()=>{
  const msg = userInput.value.trim();
  if(msg==="") return;
  addMessage(msg,true);
  setTimeout(()=>addMessage(findAnswer(msg)),100);
  userInput.value="";
};

userInput.addEventListener("keypress", e=>{
  if(e.key==="Enter") sendBtn.click();
});

/* ===== プレースホルダー回転 ===== */
const placeholders=[
  "ご質問を入力ください",
  "音声入力はマイクをPush！",
  "チェックイン時の不明点や、",
  "駐車場、食事などお尋ねください",
  "お電話なら0297-72-1123まで.."
];

let phIndex = 0;
function rotatePlaceholder(){
  userInput.placeholder = placeholders[phIndex];
  phIndex = (phIndex + 1) % placeholders.length;
}
setInterval(rotatePlaceholder, 3000);
rotatePlaceholder();

/* ===== 音声入力 ===== */
let recognition = null;

if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window){
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new SR();
  recognition.lang = "ja-JP";

  recognition.onstart = ()=> micBtn.classList.add("recording");
  recognition.onend   = ()=> micBtn.classList.remove("recording");
  recognition.onerror = ()=> micBtn.classList.remove("recording");

  recognition.onresult = e=>{
    userInput.value = e.results[0][0].transcript;
    sendBtn.click();
  };
}

micBtn.onclick = ()=>{
  if(recognition){
    recognition.start();
  } else {
    alert("このブラウザでは音声入力に対応していません。");
  }
};

  /* ===== 無操作時 自動クローズ＋ホームへ ===== */

/* 無操作時間（ミリ秒）
   例：２分 = 180000
*/
const AUTO_CLOSE_TIME = 120000;

let autoCloseTimer = null;

/* タイマー開始／リセット */
function resetAutoCloseTimer(){
  if(autoCloseTimer) clearTimeout(autoCloseTimer);

  autoCloseTimer = setTimeout(()=>{
    // チャットを閉じる
    document.getElementById("chatbox").style.display = "none";

    // ホームへ戻る
    window.location.href = "https://www.centralhoteltoride.com/";
  }, AUTO_CLOSE_TIME);
}

/* 操作とみなすイベント */
[
  "click",
  "keydown",
  "mousemove",
  "touchstart",
  "scroll"
].forEach(evt=>{
  document.addEventListener(evt, resetAutoCloseTimer, { passive:true });
});

/* 初期起動 */
resetAutoCloseTimer();
</script>

</body>
</html>




